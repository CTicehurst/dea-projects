

sources:
  - product: ts_cloud_mask
    group_by: solar_day
    mask_nodata: False
    measurements: [ cloud_mask ]

input_region:
  tiles:
    - [11,-42]
    - [17,-39]
    - [12,-47]
    - [5,-39]
    - [-4,-25]
    - [-15,-39]
    - [14,-19]
    - [16,-34]
    - [7,-34]
    - [12,-15]
    - [14,-41]
    - [15, -40]
    - [-3,-16]
    - [-5,-16]


storage:
  driver: NetCDF CF

  crs: EPSG:3577
  tile_size:
          x: 100000.0
          y: 100000.0
  resolution:
          x: 10
          y: -10
  chunking:
      x: 200
      y: 200
      time: 1
  dimension_order: [time, y, x]


output_products:
 - name: cloud_count
   product_type: cloud_statistics
   file_path_template: 'S2_TSMASK_COUNT/S2_TSMASK_COUNT_{x}_{y}_{epoch_start:%Y%m%d}_{epoch_end:%Y%m%d}.nc'

   statistic: external
   statistic_args:
     impl: valuecount.MaskValueCounter
     nodata_value: 1
     vars:
       - name: cloud_tsmask_count
         equal: 3
       - name: shadow_tsmask_count
         equal: 2
       - name: total_observation_count
         simple: True
         not_equal: 1


   output_params:
     zlib: True
     fletcher32: True


date_ranges:
  start_date: 2016-07-01
  end_date: 2018-07-01

location: '/g/data/u46/users/fxy120/CLOUD/'

computation:
  chunking:
    x: 4000
    y: 4000


global_attributes:
  title: Cloud Statistics - 10m
  product_version: Version 0.0.1
  institution: Geoscience Australia - Client Services
  license: CC BY Attribution 4.0 International License
  summary: 'Summary statistics for cloud detections.'

  platform: Sentinel-2
  instrument: MSI
  publisher_email: earth.observation@ga.gov.au
  publisher_name: Section Leader, Operations Section, NEMO, Geoscience Australia
  publisher_url: http://www.ga.gov.au

  cdm_data_type: Grid
  acknowledgment: Contains modified Copernicus Sentinel data [2018].
  source: Remotely observed surface reflectance and modelled cloud/shadow
